---
title: "HW 1 | Визуализация биомедицинских данных"
author: Serebryakova Olga
output: html_notebook
---


```{r, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


#Загрузка библиотек
```{r}
library("psych")
library("plyr")
library("dplyr")
library("ggplot2")
library("ggpubr")
library("dplyr")
```

#Задание 1
```{r}
df <- read.csv("insurance_cost.csv")
summary(df)
```

#Задание 2
```{r}
ggplot(data = df, 
       aes(x = age)) +
  geom_histogram()+
  theme_minimal()

ggplot(data = df, 
       aes(x = bmi)) +
  geom_histogram()+
  theme_minimal()

ggplot(data = df, 
       aes(x = children)) +
  geom_histogram()+
  theme_minimal()

ggplot(data = df, 
       aes(x = charges)) +
  geom_histogram()+
  theme_minimal()

```


#Задание 3
```{r}
charges_mean <- round(mean(df$charges),1)
charges_mediana <- round(median(df$charges),1)

MMs = ggplot(data = df, 
       aes(x = charges)) +
  geom_density() +
  theme_minimal() + 
  labs(x = "Выплаченная за год сумма на лечение",
  y = "Плотность") +
  geom_vline(aes(xintercept = charges_mean), color = 'blue') +
  annotate("text", 
           x= charges_mean+6000, 
           y=5e-05,
           col = 'blue',
           label=paste0("Mean=",charges_mean)) +
  geom_vline(aes(xintercept = charges_mediana), color = 'red') +
  annotate("text", 
           x= charges_mediana+6000, 
           y=3e-05, 
           col = 'red',
           label=paste0("Mediana=",charges_mediana))
print(MMs)

```
#Задание 4
```{r}

sex = ggplot(data = df, 
       aes(x = charges, y = sex)) +
  geom_boxplot()+
  labs(x = "Выплаченная за год сумма",
  y = "Пол")+
  coord_flip()+
  theme_minimal()

smoker = ggplot(data = df, 
       aes(x = charges, y = smoker)) +
  geom_boxplot()+
  labs(x= "", y = "Курильщик")+
  coord_flip()+
  theme_minimal()

region = ggplot(data = df, 
       aes(x = charges, y = region)) +
  geom_boxplot()+
  labs(x = "Выплаченная за год сумма",y = "Регион проживания")+
  theme_minimal()

combine_plot <- ggarrange(sex, smoker, region,
                          ncol = 3, nrow = 1)
print(combine_plot)
```
#Задание 5
```{r}

text <- "Рисунок 1"
tgrob <- text_grob(text,size = 14)
plot_0 <- as_ggplot(tgrob) + theme(plot.margin = margin(0,3,0,0, "cm"))
combine_plot2 = ggarrange(plot_0, MMs, combine_plot, ncol = 1, nrow = 3)
print(combine_plot2)
```
#Задание 6
```{r}

MM = df%>%
group_by(region)%>% 
summarise(Mean=mean(charges), Median=median(charges))

plot = ggplot(data = df, 
       aes(x = charges)) +
  geom_density() +
  theme_minimal() + 
  labs(x = "Выплаченная за год сумма на лечение",
  y = "Плотность") +
  facet_grid(. ~ region, labeller = label_value) +
  theme_minimal()
  
plot + geom_vline(data=MM, aes(xintercept=Median, color='red'),
               linetype="solid") +
  geom_vline(data=MM, aes(xintercept=Mean, color='blue', ),
               linetype="solid")+
  labs(title="Рисунок 2") +
  scale_color_manual(labels = c("Mean", "Median"), values = c("blue", "red")) +
  scale_fill_discrete(labels = paste(levels(MM$region), table(MM$region)))
```
#Задание 7
```{r}
df %>% 
  filter(charges != 0 & age != 0) %>% 
  ggplot(aes(x=age, y=charges)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных age и charges", x = "Возраст",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5))
  
```
#Задание 8
```{r}
df %>% 
  filter(charges != 0 & age != 0) %>% 
  ggplot(aes(x=age, y=charges)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных age и charges", x = "Возраст",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_smooth(method=lm, 
              color="red", fullrange = T,
              fill="#A69788", 
              se=TRUE)

```
#Задание 9
```{r}
df %>% 
  filter(charges != 0 & age != 0) %>% 
  ggplot(aes(x=age, y=charges, color=smoker)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных age и charges", x = "Возраст",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_smooth(method = lm, se=TRUE)

#Вариант 2
df %>% 
  filter(charges != 0 & age != 0) %>% 
  ggplot(aes(x=age, y=charges, color=smoker)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных age и charges", x = "Возраст",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5)) +
geom_smooth(aes(group = smoker),
    method=lm, 
    color="red", fullrange = T,
    fill="#A69788", 
    se=TRUE)
```
#Задание 10
```{r}
df %>% 
  filter(charges != 0 & bmi != 0) %>% 
  ggplot(aes(x=bmi, y=charges, color=smoker)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных BMI и charges", x = "Индекс массы тела",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_smooth(method = lm, se=TRUE)

#Вариант 2
df %>% 
  filter(charges != 0 & bmi != 0) %>% 
  ggplot(aes(x=bmi, y=charges, color=smoker)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных BMI и charges", x = "Индекс массы тела",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5)) +
geom_smooth(aes(group = smoker),
    method=lm, 
    color="red", fullrange = T,
    fill="#A69788", 
    se=TRUE)
```
#Задание 11
Вопрос: зависят ли размер выплат за год от того, является ли семья многодетной (3 и более ребенка в семье)? Ответ - не зависят. Данный тип графика выбрала, так как есть одна числовая и одна категориальная переменная, по Box plot'у можно примерно понять будут ли отличия в двух группах. На втором графике 2 линии тренда в зависимости отт многодетности. 
```{r}
df <- df %>% 
  mutate(
    children_ch = as.character(children),
    children_ch = case_when(
      children < 3 ~ "нет",
      children >= 3 ~ "да"
    ))

ggplot(data = df, 
       aes(x = charges, y = children_ch)) +
  geom_boxplot(aes(color = children_ch)) +
  labs(title = "Зависимость выплат от количества детей в семье", x = "Выплаченная за год сумма",
  y = "Многодетность")+
  coord_flip()+
  theme_minimal()

df %>% 
  filter(charges != 0 & age != 0) %>% 
  ggplot(aes(x=age, y=charges, color=children_ch)) + 
    geom_point(size=3) +
  theme_minimal() +
  labs(title= "Scatter plot отношения переменных age и charges", x = "Возраст",
  y = "Выплаченная за год сумма на лечение") +
  theme(axis.text.x = element_text(size=14)) +
  theme(plot.title = element_text(hjust = 0.5)) +
  geom_smooth(method = lm, se=TRUE)


```

#Задание 12
Вопрос: как зависят выплаченная за год сумма на лечение от пола в разных возрастных группах? Box plot выбран, так как есть две номинативные переменные и одна числовая. 
```{r}

df <- df %>% 
  mutate(
    age_group = case_when(
      age < 35 ~ "21-34",
      age >= 35 & age < 50 ~ "35-49",
      age >= 50 ~ "50+"
    ))

ggplot() +
  geom_boxplot(data = df, 
               aes(x = charges, y = sex, fill = age_group)) +
  labs(title = "Траты в зависимости от пола в разных возрастных группах", x = "Траты",
  y = "Пол")+
  theme_minimal()

```

#Задание 13
Вопрос: есть ли различия в индексе массы тела в зависимости от возраста в разных регионах проживания? Box plot выбран, так как есть две номинативные переменные и одна числовая. 
```{r}
ggplot() +
  geom_boxplot(data = df, 
               aes(x = bmi, y = region, fill = age_group)) +
  labs(title = "Различия в ИМТ в зависимости от возраста в разных регионах проживания", x = "Индекс массы тела",
  y = "Регион проживания")+
  theme_minimal()
```

#Задание 14
```{r}
plot2 = ggplot(data = df, 
       aes(x=bmi, y=log(charges), color='blueviolet')) + 
    geom_point(size=1) +
  theme_minimal() +
  labs(x = "bmi",
  y = "log(charges)") +
  facet_grid(. ~ age_group, labeller = label_value) +
  labs(title="Отношение индекса массы тела к логарифму трат по возрастным группам") +
  theme(legend.position = "none") +
  theme_minimal()
plot2+geom_smooth(method=lm, fullrange = T, se=TRUE)


#Вариант 2
age1 = df %>% 
  filter(charges != 0 & bmi != 0 & age_group == '21-34') %>% 
  ggplot(aes(x=bmi, y=log(charges), color='blueviolet')) + 
    geom_point(size=1) +
  theme_minimal() +
  labs(title= "age: 21-34",
  y = "log(charges)") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none") +
  geom_smooth(method = lm, se=TRUE, color="red", fullrange = T)

age2 = df %>% 
  filter(charges != 0 & bmi != 0 & age_group == '35-49') %>% 
  ggplot(aes(x=bmi, y=log(charges), color='blueviolet')) + 
    geom_point(size=1) +
  theme_minimal() +
  labs(title= "age: 35-49", x = "bmi") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none") +
  geom_smooth(method = lm, se=TRUE, color="green", fullrange = T)

age3 = df %>% 
  filter(charges != 0 & bmi != 0 & age_group == '50+') %>% 
  ggplot(aes(x=bmi, y=log(charges), color='blueviolet')) + 
    geom_point(size=1) +
  theme_minimal() +
  labs(title= "age: 21-34") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none") +
  geom_smooth(method = lm, se=TRUE, color="blue", fullrange = T)

combine_plot3 <- ggarrange(age1, age2, age3,
                          ncol = 3, nrow = 1)
print(combine_plot3)


```




When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
